<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CRUD Mascotas | API con Laravel 8</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Esta guía le dará un ejemplo de como crear una API Rest con Laravel 8 y Passport">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/doc-api-laravel-8/assets/css/0.styles.6679b527.css" as="style"><link rel="preload" href="/doc-api-laravel-8/assets/js/app.80cabc0c.js" as="script"><link rel="preload" href="/doc-api-laravel-8/assets/js/2.a98ad724.js" as="script"><link rel="preload" href="/doc-api-laravel-8/assets/js/14.9572ecc3.js" as="script"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/10.2d185829.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/11.fd777bfd.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/12.98c51b0f.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/13.31e0497b.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/15.f1a24800.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/16.5b60b770.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/17.6b4a2b80.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/18.a820c1df.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/19.bc2b8135.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/20.249ba281.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/21.89171119.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/22.d983b2aa.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/3.831b4f47.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/4.83fce895.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/5.33a173f2.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/6.7a505dc8.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/7.14b60190.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/8.5fa18e07.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/9.35501b87.js">
    <link rel="stylesheet" href="/doc-api-laravel-8/assets/css/0.styles.6679b527.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc-api-laravel-8/" class="home-link router-link-active"><!----> <span class="site-name">API con Laravel 8</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc-api-laravel-8/introduccion/" class="nav-link">
  Guía
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc-api-laravel-8/introduccion/" class="nav-link">
  Guía
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc-api-laravel-8/introduccion/" class="sidebar-link">Introducción</a></li><li><a href="/doc-api-laravel-8/instalacion/" class="sidebar-link">Instalación</a></li><li><a href="/doc-api-laravel-8/basedatos/" class="sidebar-link">Conexión y configuración Base de datos</a></li><li><a href="/doc-api-laravel-8/modelos/" class="sidebar-link">Modelos y Migraciones</a></li><li><a href="/doc-api-laravel-8/seeder-factory-faker/" class="sidebar-link">Seeders, Factories y Faker</a></li><li><a href="/doc-api-laravel-8/controlador-ruta/" class="sidebar-link">Controladores y Rutas</a></li><li><a href="/doc-api-laravel-8/passport/" class="sidebar-link">Instalación y configuración de Passport</a></li><li><a href="/doc-api-laravel-8/login/" class="sidebar-link">Login</a></li><li><a href="/doc-api-laravel-8/rutas-protegidas/" class="sidebar-link">Rutas protegidas</a></li><li><a href="/doc-api-laravel-8/cerrar-sesion/" class="sidebar-link">Cerrar sesión</a></li><li><a href="/doc-api-laravel-8/crud-generos/" class="sidebar-link">Registrar, Actualizar y Eliminar Géneros</a></li><li><a href="/doc-api-laravel-8/crud-mascotas/" aria-current="page" class="active sidebar-link">CRUD Mascotas</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="crud-mascotas"><a href="#crud-mascotas" class="header-anchor">#</a> CRUD Mascotas</h1> <h3 id="listar-mascotas"><a href="#listar-mascotas" class="header-anchor">#</a> Listar Mascotas</h3> <p>Para listar grandes cantidades de datos como lo podrián ser nuestro listado de mascotas, por optimización no es conveniente retornar toda la data de golpe, lo mejor sería dividir esa data en pequeños bloques de datos, es hay ahí donde entra en juego la <a href="https://laravel.com/docs/8.x/pagination#introduction" target="_blank" rel="noopener noreferrer">Paginación<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> de Laravel.</p> <h4 id="paginacion"><a href="#paginacion" class="header-anchor">#</a> Paginación</h4> <p>En otros marcos, la paginación puede ser muy dolorosa. Esperamos que el enfoque de Laravel a la paginación sea un soplo de aire fresco. El paginador de Laravel está integrado con el generador de consultas y Eloquent ORM, que proporciona una paginación conveniente y fácil de usar de los registros de la base de datos sin configuración.</p> <p>Hay varias formas de paginar elementos. La más simple es usar el paginate método en el generador de consultas o una consulta Eloquent . El paginate método se encarga automáticamente de establecer el <strong>&quot;límite&quot;</strong> y el <strong>&quot;desplazamiento&quot;</strong> de la consulta en función de la página actual que está viendo el usuario. De forma predeterminada, la página actual es detectada por el valor del page argumento de la cadena de consulta en la solicitud HTTP. Laravel detecta automáticamente este valor y también se inserta automáticamente en los enlaces generados por el paginador.</p> <p>Lo primero será crear el controlador que administre la lógica de nuestras mascotas, este controlador lo llamaremos <em><strong>PetController</strong></em> y será de tipo API, lo creamos con el siguiente comando:</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan make:controller PetController --api
</code></pre></div><p>Luego de creado el controlador que haremos para listar nuestras mascotas paginadas, será crear una ruta que reciba un parámetro con el límite que le pasaremos al paginador de Laravel, esta ruta apuntará al método <em><strong>index</strong></em> de <em><strong>PetController</strong></em>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/pets/{limit?}'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name static-context">PetController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Listar paginado</span>
</code></pre></div><p>Ahora configuremos el método index de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Si mandamos un limit lo asignamos y si no por defecto sera de 5 el paginado</span>
    <span class="token variable">$limit</span> <span class="token operator">?</span> <span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token variable">$limit</span> <span class="token punctuation">:</span> <span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token comment">//Buscamos las mascotas y hacemos join con las respectivas tablas y retornamos paginado el resultado</span>
    <span class="token variable">$pets</span> <span class="token operator">=</span> <span class="token class-name static-context">Pet</span><span class="token operator">::</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pets.id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pets.name as pet'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pets.age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'users.name as user'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'genders.name as gender'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pets.id_user'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'users.id'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'genders'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pets.id_gender'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'genders.id'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">OrderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'desc'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ok'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'data'</span> <span class="token operator">=&gt;</span> <span class="token variable">$pets</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Ahora consumamos este EndPoint desde el cliente HTTP para ver la magia de la paginación, en mi caso le mandare un limit de 2:</p> <p><a href="/doc-api-laravel-8/img/list-mascotas.png" target="blank"><img src="/doc-api-laravel-8/img/list-mascotas.png"></a>
Como ves en la imagen efectivamente nos retorno solo los 2 registros como le especificamos en el limit y nos retorno también toda la info para armar la paginación en nuestro frontend, como lo es el número de páginas, links, la página en que estamos, el siguiente enlace, el número de registros, etc...</p> <p>Para pasar a la siguiente página solo sería agregar el <em><strong>page</strong></em> a nuestra URL de la siguiente manera <a href="http://127.0.0.1:8000/api/pets/2?page=2" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8000/api/pets/2?page=2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <p><a href="/doc-api-laravel-8/img/list-mascotas-page2.png" target="blank"><img src="/doc-api-laravel-8/img/list-mascotas-page2.png"></a>
Con esto ya sabemos como paginar con Laravel.</p> <h3 id="registrar"><a href="#registrar" class="header-anchor">#</a> Registrar</h3> <h4 id="api-resource-routes"><a href="#api-resource-routes" class="header-anchor">#</a> <a href="https://laravel.com/docs/8.x/controllers#api-resource-routes" target="_blank" rel="noopener noreferrer">API Resource Routes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>El enrutamiento de recursos de laravel asigna las rutas típicas &quot;crud&quot; a un controlador con una sola línea de código.
Al declarar rutas de recursos que serán consumidas por las API, normalmente querrá excluir rutas que presenten plantillas HTML como create y edit. Por conveniencia, puede utilizar el apiResource método para excluir automáticamente estas dos rutas:</p> <ul><li><em><strong>Route::apiResource()</strong></em> solo crea rutas para indexar, almacenar, mostrar, actualizar y destruir.</li> <li><em><strong>Route::resource()</strong></em> también agrega una ruta de creación y edición que no tiene sentido en un contexto de API.</li></ul> <p>Teniendo claro lo anterior nuestra ruta quedará de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">apiResource</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/pets'</span><span class="token punctuation">,</span> <span class="token class-name static-context">PetController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Para ver el listado de rutas creada con el <em><strong>apiResource</strong></em> ejecutamos el siguiente comando:</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan route:list
</code></pre></div><p>Ten en cuenta que varias de las rutas creadas con nuestra ruta de recurso comparten la misma URL lo que cambia es el método <em><strong>(GET,POST,PUT,DELETE)</strong></em></p> <p>Nuestro método store lo configuramos así:</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">store</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>   
        <span class="token comment">//Regla de validación</span>
        <span class="token variable">$rules</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'name'</span>      <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'required|string'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'age'</span>       <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'required|numeric'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'gender'</span>    <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'required|numeric'</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//Validamos</span>
        <span class="token variable">$validator</span> <span class="token operator">=</span> <span class="token class-name static-context">Validator</span><span class="token operator">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$rules</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Retorna si falla la validación</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$validator</span><span class="token operator">-&gt;</span><span class="token function">fails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$validator</span><span class="token operator">-&gt;</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//Comprobamos que exista el género enviado</span>
        <span class="token variable">$gender</span> <span class="token operator">=</span> <span class="token class-name static-context">Gender</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">gender</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$gender</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Instancia al modelo de Mascota</span>
            <span class="token variable">$newPet</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$newPet</span><span class="token operator">-&gt;</span><span class="token property">name</span>       <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
            <span class="token variable">$newPet</span><span class="token operator">-&gt;</span><span class="token property">age</span>        <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">age</span><span class="token punctuation">;</span>
            <span class="token variable">$newPet</span><span class="token operator">-&gt;</span><span class="token property">id_gender</span>  <span class="token operator">=</span> <span class="token variable">$gender</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
            <span class="token variable">$newPet</span><span class="token operator">-&gt;</span><span class="token property">id_user</span>    <span class="token operator">=</span> <span class="token class-name static-context">Auth</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span><span class="token comment">//ID del usuario logeado</span>
            <span class="token comment">//Guardamos</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$newPet</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Registro exitoso&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$newPet</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Error al guardar el registro&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;El género enviado no existe&quot;</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>No olvides importar estas clases en el controlador :</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Gender</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Pet</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Auth</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Validator</span><span class="token punctuation">;</span>
</code></pre></div><p>Con esto ya podemos registrar masconas:</p> <p><a href="/doc-api-laravel-8/img/registro-mascotas.png" target="blank"><img src="/doc-api-laravel-8/img/registro-mascotas.png"></a></p> <h3 id="actualizar"><a href="#actualizar" class="header-anchor">#</a> Actualizar</h3> <p>Como ya tenemos la ruta para actualizar creada, solo sería configurar el método <em><strong>update</strong></em> de nuestro controlador <em><strong>PetController</strong></em> de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$rules</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'name'</span>      <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'required|string'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'age'</span>       <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'required|numeric'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'gender'</span>    <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'required|numeric'</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$validator</span> <span class="token operator">=</span> <span class="token class-name static-context">Validator</span><span class="token operator">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$rules</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$validator</span><span class="token operator">-&gt;</span><span class="token function">fails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$validator</span><span class="token operator">-&gt;</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//Buscamos la mascota por el ID</span>
        <span class="token variable">$pet</span> <span class="token operator">=</span> <span class="token class-name static-context">Pet</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Comprobamos que exista la mascota</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Buscamos y comprobamo que le género enviado exista</span>
            <span class="token variable">$gender</span> <span class="token operator">=</span> <span class="token class-name static-context">Gender</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">gender</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$gender</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//Remplazamos los datos de la mascota por los enviados por Request</span>
                <span class="token variable">$pet</span><span class="token operator">-&gt;</span><span class="token property">name</span>       <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
                <span class="token variable">$pet</span><span class="token operator">-&gt;</span><span class="token property">age</span>        <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">age</span><span class="token punctuation">;</span>
                <span class="token variable">$pet</span><span class="token operator">-&gt;</span><span class="token property">id_gender</span>  <span class="token operator">=</span> <span class="token variable">$gender</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
                <span class="token comment">//Actualizamos</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pet</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                        <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Registro actualizado con exito&quot;</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$pet</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                        <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Error al actualizar el registro&quot;</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;El género enviado no existe&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;La mascota no existe&quot;</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Para actualizar una mascota, mandamos por nuestra ruta el ID de la siguiente manera por método <em><strong>PUT</strong></em> <a href="http://127.0.0.1:8000/api/pets/1" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8000/api/pets/1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> y los nuevos valores a cambiar de dicha mascota:</p> <p><a href="/doc-api-laravel-8/img/actualizar-mascotas.png" target="blank"><img src="/doc-api-laravel-8/img/actualizar-mascotas.png"></a></p> <h3 id="eliminar"><a href="#eliminar" class="header-anchor">#</a> Eliminar</h3> <p>Método <em><strong>destroy</strong></em> de <em><strong>PetController</strong></em> :</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">destroy</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Buscamos la mascota a elminar por el ID</span>
        <span class="token variable">$pet</span> <span class="token operator">=</span> <span class="token class-name static-context">Pet</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Coprobamos que exista la mascota</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Borramos</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pet</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Registro eliminado con exito&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;Error al eliminar el registro&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token string double-quoted-string">&quot;message&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;El registro a eliminar no existe&quot;</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;data&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Llamamos este EndPoint exactamente con la misma ruta del de actualizar solo cambia el método que será <em><strong>DELETE</strong></em></p> <p><a href="/doc-api-laravel-8/img/borrar-mascotas.png" target="blank"><img src="/doc-api-laravel-8/img/borrar-mascotas.png"></a></p> <p>Listo con esto hemos terminado el CRUD de mascotas.
</p><p style="font-size:50px;">😎</p><p></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/doc-api-laravel-8/crud-generos/" class="prev">
        Registrar, Actualizar y Eliminar Géneros
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/doc-api-laravel-8/assets/js/app.80cabc0c.js" defer></script><script src="/doc-api-laravel-8/assets/js/2.a98ad724.js" defer></script><script src="/doc-api-laravel-8/assets/js/14.9572ecc3.js" defer></script>
  </body>
</html>
