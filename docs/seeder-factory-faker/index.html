<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Seeders, Factories y Faker | API con Laravel 8</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Esta guía le dará un ejemplo de como crear una API Rest con Laravel 8 y Passport">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/doc-api-laravel-8/assets/css/0.styles.6679b527.css" as="style"><link rel="preload" href="/doc-api-laravel-8/assets/js/app.210ecdd7.js" as="script"><link rel="preload" href="/doc-api-laravel-8/assets/js/2.a98ad724.js" as="script"><link rel="preload" href="/doc-api-laravel-8/assets/js/19.c58bd4c3.js" as="script"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/10.efcb5b7e.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/11.b9435b81.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/12.a8a1714e.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/13.3a462bfb.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/14.596327b1.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/15.0150155a.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/16.4aa4b4f0.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/17.e4a5b8be.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/18.38de6797.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/3.907d2391.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/4.83fce895.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/5.33a173f2.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/6.7a505dc8.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/7.14b60190.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/8.c010c834.js"><link rel="prefetch" href="/doc-api-laravel-8/assets/js/9.35501b87.js">
    <link rel="stylesheet" href="/doc-api-laravel-8/assets/css/0.styles.6679b527.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc-api-laravel-8/" class="home-link router-link-active"><!----> <span class="site-name">API con Laravel 8</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc-api-laravel-8/introduccion/" class="nav-link">
  Guía
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc-api-laravel-8/introduccion/" class="nav-link">
  Guía
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc-api-laravel-8/introduccion/" class="sidebar-link">Introducción</a></li><li><a href="/doc-api-laravel-8/instalacion/" class="sidebar-link">Instalación</a></li><li><a href="/doc-api-laravel-8/basedatos/" class="sidebar-link">Conexión y configuración Base de datos</a></li><li><a href="/doc-api-laravel-8/modelos/" class="sidebar-link">Modelos y Migraciones</a></li><li><a href="/doc-api-laravel-8/seeder-factory-faker/" aria-current="page" class="active sidebar-link">Seeders, Factories y Faker</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/doc-api-laravel-8/controlador-ruta/" class="sidebar-link">Controladores y Rutas</a></li><li><a href="/doc-api-laravel-8/passport/" class="sidebar-link">Instalación y configuración de Passport</a></li><li><a href="/doc-api-laravel-8/login/" class="sidebar-link">Login</a></li><li><a href="/doc-api-laravel-8/rutas-protegidas/" class="sidebar-link">Rutas protegidas</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="seeders-factories-y-faker"><a href="#seeders-factories-y-faker" class="header-anchor">#</a> Seeders, Factories y Faker</h1> <h3 id="¿que-son-los-seeders"><a href="#¿que-son-los-seeders" class="header-anchor">#</a> ¿Qué son los seeders?</h3> <p>Los seeders no son más que componentes del framework Laravel que sirven para inicializar las tablas con datos. Así como las migraciones nos permiten especificar el esquema de la base de datos, los seeders nos permiten también por medio de código alimentar las tablas con datos.</p> <p>Una seeder sólo contiene un método por defecto: <strong>run</strong>. Este método se llama cuando se ejecuta el <strong>db:seed</strong> comando Artisan. Dentro del runmétodo, puede insertar datos en su base de datos como desee. Puede usar el generador de consultas para insertar datos manualmente o puede usar las fábricas de modelos Eloquent.</p> <h4 id="ejemplo"><a href="#ejemplo" class="header-anchor">#</a> Ejemplo:</h4> <p>Modifiquemos la DatabaseSeederclase predeterminada y agreguemos una declaración de inserción de base de datos al runmétodo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Database<span class="token punctuation">\</span>Seeders</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Seeder</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>DB</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Hash</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Str</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">DatabaseSeeder</span> <span class="token keyword">extends</span> <span class="token class-name">Seeder</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Run the database seeders.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'@gmail.com'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'password'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Hash</span><span class="token operator">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Con el codigo anterior si corremos el comando artisan</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan migrate:fresh --seed
</code></pre></div><p>Esto nos creará un nuevo usuario en la base de datos.</p> <h3 id="factories"><a href="#factories" class="header-anchor">#</a> Factories</h3> <p>Por supuesto, especificar manualmente los atributos para cada seeder de modelo es engorroso. En su lugar, puede utilizar los factories para generar de forma conveniente grandes cantidades de registros de bases de datos. Primero, revise la <a href="https://laravel.com/docs/8.x/database-testing#defining-model-factories" target="_blank" rel="noopener noreferrer">documentación<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> de los factories para aprender cómo definir sus factories.</p> <p>Para ver un ejemplo de cómo escribir un factory, eche un vistazo al <b>database/factories/UserFactory.phparchivo</b> en su aplicación. Este factory se incluye con todas las nuevas aplicaciones de Laravel y contiene la siguiente definición:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">Database<span class="token punctuation">\</span>Factories</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Factories<span class="token punctuation">\</span>Factory</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Str</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">UserFactory</span> <span class="token keyword">extends</span> <span class="token class-name">Factory</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Define the model's default state.
     *
     * @return array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">definition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">safeEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'email_verified_at'</span> <span class="token operator">=&gt;</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'password'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi'</span><span class="token punctuation">,</span> <span class="token comment">// password</span>
            <span class="token string single-quoted-string">'remember_token'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
 
</code></pre></div><p>Como puede ver, en su forma más básica, las fábricas son clases que extienden la clase de fábrica base de Laravel y definen el definitionmétodo. El definitionmétodo devuelve el conjunto predeterminado de valores de atributo que se deben aplicar al crear un modelo utilizando la fábrica.</p> <p>A través de la faker propiedad, los factories tienen acceso a la biblioteca PHP de <a href="https://fakerphp.github.io/" target="_blank" rel="noopener noreferrer">Faker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, que le permite generar convenientemente varios tipos de datos aleatorios para realizar pruebas.</p> <h3 id="creando-usuario-mascotas-y-generos-con-factory"><a href="#creando-usuario-mascotas-y-generos-con-factory" class="header-anchor">#</a> Creando Usuario, Mascotas y Generos con Factory</h3> <p>En los capítulos anteriores cuando creamos nuestro modelos tambien habíamos creado el factory de cada uno de ellos, ahora configuremos estas clases para llenar nuestra base de datos.</p> <h4 id="userfactory"><a href="#userfactory" class="header-anchor">#</a> UserFactory</h4> <p>Este factory ya viene por defecto en Laravel, pero nosotros modificaremos sun datos para crear un usuario personalizado, nuestro método definition quedara de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">definition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'admin@admin.com'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'email_verified_at'</span> <span class="token operator">=&gt;</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'password'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi'</span><span class="token punctuation">,</span> <span class="token comment">// password</span>
            <span class="token string single-quoted-string">'remember_token'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="genderfactory"><a href="#genderfactory" class="header-anchor">#</a> GenderFactory</h4> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">definition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
           <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token function">randomElement</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Masculino'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Femenino'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="petfactory"><a href="#petfactory" class="header-anchor">#</a> PetFactory</h4> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">definition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'age'</span>  <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token function">randomNumber</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'id_gender'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">faker</span><span class="token operator">-&gt;</span><span class="token function">numberBetween</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'id_user'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Ya hemos llenado los datos de nuestro Factory ahora paseremos a llamarlos desde nuestro seeder para crear los registros; Dentro del DatabaseSeeder en el metodo run escribiremos los siguiente:</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//el numero es la cantidad a crear</span>
         <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Gender</span><span class="token operator">::</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Pet</span><span class="token operator">::</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Por último, corramos de nuevo nuestras migraciones junto con los seeders y luego revisemos las tablas de la base de datos, y ya estarán 1 usuario, 2 generos y 20 mascotas.</p> <div class="language- extra-class"><pre class="language-text"><code>php artisan migrate:fresh --seed
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/doc-api-laravel-8/modelos/" class="prev">
        Modelos y Migraciones
      </a></span> <span class="next"><a href="/doc-api-laravel-8/controlador-ruta/">
        Controladores y Rutas
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/doc-api-laravel-8/assets/js/app.210ecdd7.js" defer></script><script src="/doc-api-laravel-8/assets/js/2.a98ad724.js" defer></script><script src="/doc-api-laravel-8/assets/js/19.c58bd4c3.js" defer></script>
  </body>
</html>
